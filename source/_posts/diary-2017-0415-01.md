---
layout: post
title: 内网王者之dns劫持
date: 2017-04-15 00:26:45
comments: true
tags:
	- 安全攻防
---

### 前言
><font color="#ff0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**文中提及的部分技术，可能带有一定攻击性，仅供安全学习和教学用途，禁止非法使用！**</font>


### 正文
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;同样不做多介绍，我们来使用ettercap这个老牌利器来完成这次实验。<!--more-->

受害者
 ![](/images/pasted-63.PNG)

攻击者
 ![](/images/pasted-64.PNG)

### 配置
>首先我们需要更改ettercap的dns配置文件，位置在于/etc/ettercap/etter.dns, 我们直接shift+g来到配置文件的最后，配置劫持的域名，和域名所解析的ip，可用*通配符

 ![](/images/pasted-65.PNG)


>我把所有.com和.cn的域名全部解析到了本地，也就是说访问.com和.cn的域名，会自动解析我的ip地址。
>
>然后我们开启web服务器并且来到/var/www/html/路径，这里是默认weib服务器的网站目录，我们新建index.html内容随意。

![](/images/pasted-70.PNG)

### 攻击

>配置完成之后我们就可以开始攻击了
> * ettercap -i eth0 -Tq -P dns_spoof /ip// /网关//

> * -i 选择网卡

> * -T 文本模式

> * -P 选择模块

* 后面的两组/，如果我选择内网里所有目标，可以不填ip，

>![](/images/pasted-66.PNG)

>可以看到检测到了3个目标，

> 我们来ping一下百度

>![](/images/pasted-67.PNG)

> 可以看到百度的解析ip变成了我们的ip，说明我们已经劫持成功了，我们来访问一下百度

>![](/images/pasted-68.PNG)
>
>劫持成功，网页显示的是我们刚刚搭建web服务器中的内容，同时还会检测到访问的所有请求，全部都劫持解析到我们的ip中来。

>也就是我们在配置文件上写的.com和.cn的域名全部会解析到我们的ip中来。

>![](/images/pasted-69.PNG)





