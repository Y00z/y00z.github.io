---
layout: post
title: 开发xposed破解模块
date: 2017-03-28 17:13:30
comments: true
tags:
	- xposed
	- 破解
---

### 前言
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最近发现了一个挺好玩的app，百变语音，就是在qq上可以把自定义的mp3以语音形式发送给好友。app上有很多男女说话的语音供用户下载使用，同时也可以把qq里面别人发的语音下载过来自己用。(当你听到一个甜美的美女声音的时候，背后可能是一个基佬。)
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;其中还有会员功能，会员功能有更多的语音，并且同时可以在微信中使用。ok让我们来分析一下吧。<!--more-->


### 反编译
>首先来反编译走一波。前面的文章有说道如何反编译，这里就不多说了。

> ![](/images/pasted-50.jpg)

>一个小小的app还有这么多包。翻`AndroidManifest`找入口的`Activity`

> ![](/images/pasted-51.jpg)

> 可以看到，指定了一个路径然后给了a.b，然后获取了包名给了a.g，然后有创建了一个HashMap给q.c，然后然后。。。。(我实在编不下去了。)
> 这特么是些啥玩意儿，然后我不看这些杂乱无章的代码，找一下关于会员的关键代码，依然找不到任何线索。
> 这时候突然看到了一个很奇怪的包名

> ![](/images/pasted-52.jpg)
> ![](/images/pasted-53.jpg)

>进去看依然是被混淆得不成样子的代码。不过为什么要叫iapp呢，于是我百度了一番。
 
> ![](/images/pasted-54.jpg)

>（这是一款神奇的软件，iApp是一款让你的手机展现放光彩的应用。轻松的操作就可以设计出，你想要的应用界面，你可以分享给你的朋友，传递你的快乐！iApp采用了可视化设计界面，让你设计界面的时候一目了然，不用繁琐的看着代码伤脑筋了！
iApp不是一款简单的应用程序，它是创造应用的应用程序。 如果你没有iApp 你就真的没有iApp！ )
<br/>
>嗯，非常好，前者有e4a，现在又出来个iapp。全都是直接拖组件的，怪不得这么多包名。

>于是不看代码了，看看app的网络请求。

> ![](/images/pasted-55.jpg)

>全都是一些注释信息和语音名单。同时把手机的IMEI码上传到了服务器。

>其中的vip.php引起了我的注意。返回 0

>于是我把这个请求使用burp重定向到了本地，返回 1，
>这个时候奇迹出现了，Duang

> ![](/images/pasted-56.jpg)

直接就成会员了。

### 末尾
>这个app原理其实很简单，利用了qq的校验不严的漏洞。在录语音的时候会在本地生成已一个语音文件，然后发送给好友就是把这个语音文件发送了出去。然而发送的时候这个语音文件和录语音时生成的语音文件并没有做校验，导致了可以任意发送语音文件。

#### 编写Hook模块。
> 结论，当访问指定地址的时候如果返回1就是会员。
> 两种方法。
> 1,把请求重定向自己的页面，返回1
> 2,把请求的响应体强制改成1

我们直接来hook网络请求模块，
```java
findAndHookMethod("org.apache.http.impl.client.AbstractHttpClient", lpparam.classLoader, "execute", HttpHost.class, HttpRequest.class, HttpContext.class, new XC_MethodHook() {
    @Override
    protected void afterHookedMethod(MethodHookParam param) throws Throwable {
        HttpRequest request = (HttpRequest) param.args[1];
        if (request instanceof org.apache.http.client.methods.HttpGet) {
            org.apache.http.client.methods.HttpGet httpGet = (org.apache.http.client.methods.HttpGet) request;
            if (httpGet.getURI().toString().contains("dess.ml/vip/vip.php?imei=")) {
                BasicHttpResponse basicHttpResponse = (BasicHttpResponse) param.getResult();
                basicHttpResponse.setEntity(new StringEntity("1", "utf-8"));
                toast("-----破解成功-----");
            }
        }
    }
});
```

> app用的是apache的网络包，当然还有一个java的网络包


<br/>
#### app和模块下载地址

 *  [http://pan.baidu.com/s/1skFxIuL](http://pan.baidu.com/s/1skFxIuL) 密码: 8zyj





